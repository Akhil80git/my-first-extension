<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Version Grouping with Filter</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }
    .folder {
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .version {
        padding: 10px 15px;
        background: #e9e9e9;
        border-radius: 8px;
        margin-bottom: 10px;
        display: block;
    }
    .group-badge {
        padding: 3px 10px;
        border-radius: 6px;
        font-size: 13px;
        margin-left: 10px;
        color: black;
    }
    .legend-container {
        margin-top: 30px;
        padding: 15px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .legend-btn {
        padding: 8px 15px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
    }
    .active-filter {
        border: 2px solid black;
    }
</style>

</head>
<body>

<div id="folders-container"></div>

<!-- GROUP LEGEND -->
<div class="legend-container">
    <strong>Groups:</strong><br><br>
    <button class="legend-btn" style="background:#ddd" onclick="showAll()">ALL</button>

    <span id="legend-buttons"></span>
</div>

<script>
    // Dummy Data Example
    const folders = {
        "KML": [
            {version: 1, time: "2025-11-16 15:11:20"},
            {version: 2, time: "2025-11-16 15:11:23"},
            {version: 3, time: "2025-11-16 15:12:00"}
        ],
        "FRONTEND": [
            {version: 1, time: "2025-11-16 15:11:22"}
        ],
        "JDHSJDJ": [
            {version: 1, time: "2025-11-16 15:11:20"}
        ]
    };

    // Convert time to timestamp
    function toTimestamp(str) {
        return new Date(str).getTime();
    }

    // GLOBAL TIMESTAMP LIST
    let allVersions = [];

    // Convert folder data to global list
    for (let folder in folders) {
        folders[folder].forEach(v => {
            allVersions.push({
                folder,
                version: v.version,
                time: v.time,
                timestamp: toTimestamp(v.time)
            });
        });
    }

    // SORT by timestamp
    allVersions.sort((a, b) => a.timestamp - b.timestamp);

    // Assign groups (3 second rule)
    let groupNumber = 1;
    allVersions[0].group = groupNumber;

    for (let i = 1; i < allVersions.length; i++) {
        const diff = (allVersions[i].timestamp - allVersions[i - 1].timestamp) / 1000;
        if (diff <= 3) {
            allVersions[i].group = groupNumber;
        } else {
            groupNumber++;
            allVersions[i].group = groupNumber;
        }
    }

    // Store max groups
    const totalGroups = groupNumber;

    // COLOR MAP
    const groupColors = ["#ffcccc", "#ffb3d1", "#cce5ff", "#d6f5d6", "#ffe6b3", "#e6ccff"];

    function render(filterGroup = null) {
        document.getElementById("folders-container").innerHTML = "";

        for (let folder in folders) {
            const div = document.createElement("div");
            div.className = "folder";

            div.innerHTML += `<h2>${folder}</h2><hr>`;

            allVersions
                .filter(v => v.folder === folder)
                .filter(v => (filterGroup ? v.group === filterGroup : true))
                .forEach(v => {
                    div.innerHTML += `
                        <div class="version">
                            Version ${v.version} - ${v.time}
                            <span class="group-badge" style="background:${groupColors[v.group - 1]}">
                                GROUP #${v.group}
                            </span>
                        </div>
                    `;
                });

            document.getElementById("folders-container").appendChild(div);
        }
    }

    // Render group legend buttons
    function renderLegend() {
        const legendDiv = document.getElementById("legend-buttons");
        for (let i = 1; i <= totalGroups; i++) {
            const btn = document.createElement("button");
            btn.className = "legend-btn";
            btn.style.background = groupColors[i - 1];
            btn.innerText = "Group " + i;
            btn.onclick = () => filterByGroup(i);
            legendDiv.appendChild(btn);
        }
    }

    // FILTER FUNCTIONS
    function filterByGroup(groupId) {
        render(groupId);
    }

    function showAll() {
        render(null);
    }

    // INITIAL LOAD
    render();
    renderLegend();
</script>

</body>
</html>
